---
export const prerender = false;
import { actions } from "astro:actions";
import Layout from "../../layouts/Layout.astro";
---

<Layout title="Inicio de Sesión">
  <main>
    <div class="login-container">
      <h1>Inicio de sesión</h1>
      <form method="post" action={actions.login} id="login-form">
        <input type="text" name="email" placeholder="Usuario" required />
        <input
          type="password"
          name="password"
          placeholder="Contraseña"
          required
        />
        <button type="submit" class="btn btn-primary" style="width: 100%;"
          >Iniciar sesión</button
        >
        <div class="options">
          <label>
            <input type="checkbox" name="remember" /> Recuérdame
          </label>
          <a href="/signup">Regístrate</a>
        </div>
      </form>
    </div>
  </main>
  <script>
    import { actions } from "astro:actions";

    const form = document.getElementById("login-form") as HTMLFormElement;

    form.addEventListener("submit", async (event) => {
      console.log("submit");

      event.preventDefault();

      const formData = new FormData(form);
      const email = formData.get("email") as string;
      const password = formData.get("password") as string;

      const { data, error } = await actions.login({ email, password });

      if (error) {
        alert(error.message);
      }

      if (data) {
        setTimeout(() => {
          window.location.href = "/dashboard";
        }, 100);
      }
    });
  </script>
</Layout>
